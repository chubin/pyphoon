#!/usr/bin/env python
#
# pyphoon - Phase of the Moon (Python version)
# Igor Chubin <igor@chub.in>, 05.03.2016, 
#
# Based on the original version of Jef Poskanzer <jef@mail.acme.com>
# written in Pascal in 1979 (and later translated to C)
#

import argparse
import dateutil.parser
import time

from pyphoon.main import putmoon, fatal

DEFAULTNUMLINES = 23
DEFAULTNOTEXT = False

if __name__ == "__main__":
    parser = argparse.ArgumentParser(description='Show Phase of the Moon')
    parser.add_argument('-n',
                        '--lines',
                        help='Number of lines to display (size of the moon)',
                        required=False,
                        default=DEFAULTNUMLINES)
    parser.add_argument('-x',
                        '--notext',
                        help='Print no additional information, just the moon',
                        required=False,
                        default=DEFAULTNOTEXT,
                        action="store_true")
    parser.add_argument('date',
                        help='Date for that the phase of the Moon '
                             'must be shown. Today by default',
                        nargs='?',
                        default=time.strftime("%Y-%m-%d %H:%M:%S"))
    parser.add_argument('-l',
                        '--language',
                        help='locale for that the phase of the Moon '
                             'must be shown. English by default',
                        nargs='?',
                        default=None)
    args = vars(parser.parse_args())

    try:
        d = time.mktime(dateutil.parser.parse(args['date']).timetuple() )
    except Exception as e:
        fatal("Can't parse date: %s" % args['date'])

    try:
        n = int( args['lines'] )
        lang = args['language']
    except Exception as e:
        print(e)
        fatal("Number of lines must be integer")

    try:
        notext = bool( args['notext'] )
    except Exception as e:
        print(e)

    print(putmoon(d, n, '@', notext, lang=lang))
